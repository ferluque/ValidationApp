<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>EarthCul Validation App</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script> -->
    <script
        src="https://cdn.jsdelivr.net/gh/xcash/bootstrap-autocomplete@v2.3.7/dist/latest/bootstrap-autocomplete.min.js"></script>

    <script>
        function deleteChildren(node) {
            while (node.firstChild) {
                node.removeChild(node.firstChild);
            }
        }
        function copyChildren(node1, node2) {
            deleteChildren(node1);
            while (node2.hasChildNodes()) {
                node1.appendChild(node2.removeChild(node2.firstChild));
            }
        }
        function setSelection(node, selection) {
            deleteChildren(node);
            var lowLevel;
            $.ajax({
                url: "http://127.0.0.1:8000/getCategories?category=" + selection,
                type: "POST",
                async: false,
                success: function (result) {
                    lowLevel = result["list"];
                },
                error: function (error) {
                    console.log(`Error ${error[0]}`)
                }
            })
            var opt = document.createElement("option");
            opt.value = "High Detail";
            opt.innerHTML = "High Detail";
            node.appendChild(opt);
            if (lowLevel != undefined) {
                for (let j = 0; j < lowLevel.length; ++j) {
                    opt = document.createElement("option");
                    opt.value = lowLevel[j];
                    opt.innerHTML = lowLevel[j];
                    node.appendChild(opt);
                }
            }
            node.style.visibility = "visible";
        }
        function inputChanged(e) {

            let firstEmpty = 5;
            let lastValue = 1;
            for (let i = 1; i < 5; i++) {
                if ((document.getElementById("combo" + i.toString() + "1").value === "Low Detail") && (firstEmpty === 5))
                    firstEmpty = i;
                if ((document.getElementById("combo" + i.toString() + "1").value != "Low Detail"))
                    lastValue = i;
            }
            console.log("FirstEmpty: " + firstEmpty.toString());
            console.log("lastValue: " + lastValue.toString());
            if (firstEmpty > lastValue) {
                // Entrada cambiada
                const selection = e.target.value;
                var combo2Name = e.target.getAttribute("name");
                combo2Name = combo2Name.replace(/1$/, "2");
                const combo2 = document.getElementById(combo2Name);
                if (selection != "Low Detail") {
                    setSelection(combo2, selection);
                }
                else {
                    deleteChildren(combo2);
                    combo2.style.visibility = "hidden";
                }
                if (firstEmpty < 5) {
                    document.getElementById("combo" + firstEmpty + "1").style.visibility = "visible";
                    document.getElementById("label" + firstEmpty).style.visiblity = "visible";
                    document.getElementById("label" + firstEmpty).children[0].style.visibility = "visible";
                }
                for (let i = firstEmpty + 1; i < 5; i++) {
                    document.getElementById("combo" + i + "1").style.visibility = "hidden";
                    document.getElementById("combo" + i + "2").style.visibility = "hidden";
                    document.getElementById("label" + i).style.visiblity = "hidden";
                    document.getElementById("label" + i).children[0].style.visibility = "hidden";
                }
            }
            else {
                for (let i = firstEmpty; i < lastValue; ++i) {
                    console.log("Cambio " + i);
                    const combo1 = document.getElementById("combo" + i + "1");
                    const combo2 = document.getElementById("combo" + i + "2");
                    const nextCombo1 = document.getElementById("combo" + (i + 1) + "1");
                    const nextCombo2 = document.getElementById("combo" + (i + 1) + "2");
                    const nextCombo2Value = nextCombo2.value;
                    combo1.value = nextCombo1.value;
                    copyChildren(combo2, nextCombo2);
                    combo2.value = nextCombo2Value;
                }
                const combo1 = document.getElementById("combo" + lastValue + "1");
                const combo2 = document.getElementById("combo" + lastValue + "2");
                combo1.value = "Low Detail";
                deleteChildren(combo2);
                combo2.style.visibility = "hidden";
                if (lastValue < 4) {
                    for (let i = lastValue + 1; i < 5; i++) {
                        document.getElementById("combo" + i + "1").style.visibility = "hidden";
                        document.getElementById("combo" + i + "2").style.visibility = "hidden";
                        document.getElementById("label" + i).style.visiblity = "hidden";
                        document.getElementById("label" + i).children[0].style.visibility = "hidden";
                    }
                }
            }
        }
    </script>
</head>

<body>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <div class="container">
        <div class="row">
            <div class="col text-center">
                <a target="_blank" href="https://decsai.ugr.es"><img class="img-fluid"
                        style="max-height: 100px; padding-top: 15px"
                        src="{{url_for('static', path='/logos/decsai.png')}}"></a>
            </div>
            <div class="col text-center">
                <a target="_blank" href="https://ugr.es"><img class="img-fluid"
                        style="max-height: 100px; padding-top: 15px"
                        src="{{url_for('static', path='/logos/ugr.png')}}"></a>
            </div>
            <div class="col text-center">
                <a target="_blank" href="https://fciencias.ugr.es"><img class="img-fluid"
                        style="max-height: 100px; padding-top: 15px"
                        src="{{url_for('static', path='/logos/fciencias.png')}}"></a>
            </div>
        </div>
        <div class="row">
            <hr style="margin-bottom: 25px; margin-top: 25px;" />
        </div>
        <div class="row text-end">
            <div class="col-6 text-start">
                <p style="margin-bottom: 0px">Validated: {{validated}}</p>
                <p style="margin-bottom: 0px">Ignored: {{ignored}}</p>
            </div>
            <div class="col-6">
                <p style="margin-bottom: 0px">Hello, {{username}}</p>
                <p><a href="/">logout</a></p>
            </div>
        </div>
        <div class="row">
            <div class="col-12 col-lg-6" style="margin-bottom: 40px">
                <div class="text-center"><img src="static/images/{{imgUrl}}" class="img-fluid"
                        style="width: 90%; box-shadow: 10px 10px 10px rgba(0, 0, 0, 0.5);" /></div>
            </div>
            <form method="post" class="col-12 col-lg-6">
                <input value="{{imgUrl}}" type="hidden" name="imgUrl" />
                <input value="{{username}}" type="hidden" name="username" />
                <div class="row">
                    <div class="col-6" id="label1">
                        <p style="font-weight: bold; font-size: 25px;">1st Label</p>
                        <select name="combo11" id="combo11" class="form-select" aria-label="Default select example"
                            style="width: 90%; margin:auto; margin-bottom: 20px" onchange="inputChanged(event)">
                            <option selected>Low Detail</option>
                            {% for option in highLevel.keys() %}
                            <option value="{{option}}">{{option}}</option>
                            {% endfor %}
                        </select>
                        <select name="combo12" id="combo12" class="form-select" aria-label="Default select example"
                            style="width: 90%; margin:auto; margin-bottom: 20px; visibility: hidden">
                        </select>
                    </div>
                    <div class="col-6" id="label2" style="visibility: hidden">
                        <p style="font-weight: bold; font-size: 25px;">2nd Label</p>
                        <select name="combo21" id="combo21" class="form-select" aria-label="Default select example"
                            style="width: 90%; margin:auto; margin-bottom: 20px" onchange="inputChanged(event)">
                            <option selected>Low Detail</option>
                            {% for option in highLevel %}
                            <option value="{{option}}">{{option}}</option>
                            {% endfor %}
                        </select>
                        <select name="combo22" id="combo22" class="form-select" aria-label="Default select example"
                            style="width: 90%; margin:auto; margin-bottom: 20px; visibility: hidden">
                        </select>
                    </div>
                </div>
                <div class="row">
                    <div class="col-6" id="label3" style="visibility: hidden">
                        <p style="font-weight: bold; font-size: 25px;">3rd Label</p>
                        <select name="combo31" id="combo31" class="form-select" aria-label="Default select example"
                            style="width: 90%; margin:auto; margin-bottom: 20px" onchange="inputChanged(event)">
                            <option selected>Low Detail</option>
                            {% for option in highLevel %}
                            <option value="{{option}}">{{option}}</option>
                            {% endfor %}
                        </select>
                        <select name="combo32" id="combo32" class="form-select" aria-label="Default select example"
                            style="width: 90%; margin:auto; margin-bottom: 20px; visibility: hidden">
                        </select>

                    </div>
                    <div class="col-6" id="label4" style="visibility: hidden">
                        <p style="font-weight: bold; font-size: 25px;">4th Label</p>
                        <select name="combo41" id="combo41" class="form-select" aria-label="Default select example"
                            style="width: 90%; margin:auto; margin-bottom: 20px" onchange="inputChanged(event)">
                            <option selected>Low Detail</option>
                            {% for option in highLevel %}
                            <option value="{{option}}">{{option}}</option>
                            {% endfor %}
                        </select>
                        <select name="combo42" id="combo42" class="form-select" aria-label="Default select example"
                            style="width: 90%; margin:auto; margin-bottom: 20px; visibility: hidden">
                        </select>
                    </div>
                </div>
                <div class="row">
                    <div class="col-4 col-lg-6">
                    </div>
                    <div class="col-4 col-lg-3">
                        <button type="button" class="btn btn-outline-danger" data-toggle="modal"
                            data-target="#exampleModal">Ignore</button>
                    </div>
                    <div class="col-4 col-lg-3">
                        <button class="btn btn-outline-success" type="submit" formaction="/submit">
                            Submit
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-body" style="font-size: 20px; font-weight: bold">
                    Are you sure?
                </div>
                <div class="modal-footer">
                    <form method="post" class="col-12 col-lg-6">
                        <input value="{{imgUrl}}" type="hidden" name="imgUrl" />
                        <input value="{{username}}" type="hidden" name="username" />
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-danger" formaction="/ignore">Confirm</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

</body>

</html>